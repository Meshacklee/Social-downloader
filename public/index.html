<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Social Media Downloader</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 700px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        .platforms {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px 0;
        }
        
        .platform {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            width: 90px;
            height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .platform:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            background: #e9ecef;
        }
        
        .platform-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .platform-name {
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            color: #495057;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #495057;
            font-size: 18px;
        }
        
        input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .info-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
        
        .video-info {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .thumbnail {
            width: 150px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            background: #e9ecef;
        }
        
        .video-details h3 {
            color: #333;
            margin-bottom: 8px;
        }
        
        .video-details p {
            color: #666;
            margin: 5px 0;
            font-size: 14px;
        }
        
        .formats {
            margin-top: 15px;
        }
        
        .format-option {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .format-option:hover {
            background: #e9ecef;
            border-color: #667eea;
        }
        
        .format-option.selected {
            background: #667eea;
            color: white;
            border-color: #5a6fd8;
        }
        
        .format-info {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .result {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            display: none;
        }
        
        .result h3 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 24px;
        }
        
        .result p {
            margin-bottom: 20px;
            color: #495057;
            font-size: 16px;
        }
        
        .download-btn {
            background: #28a745;
            padding: 14px 25px;
            font-size: 16px;
        }
        
        .loading {
            text-align: center;
            display: none;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .note {
            text-align: center;
            color: #868e96;
            font-size: 14px;
            margin-top: 20px;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
        }
        
        .btn-group button {
            flex: 1;
            margin-top: 0;
        }
        
        .get-info-btn {
            background: #20c997;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“¥ MediaGrab Pro</h1>
        <p class="subtitle">Download videos with thumbnails & quality selection</p>
        
        <div class="platforms" id="platformsContainer">
            <!-- Platforms will be loaded here -->
        </div>
        
        <div class="input-group">
            <label for="videoUrl">Paste Video URL:</label>
            <input type="url" id="videoUrl" placeholder="https://www.youtube.com/watch?v=... or https://www.instagram.com/p/...">
        </div>
        
        <div class="btn-group">
            <button id="getInfoBtn" class="get-info-btn">Get Video Info</button>
            <button id="downloadBtn">Download Video</button>
        </div>

     <!-- Add this button after the existing buttons in your main index.html -->
        <div style="margin-top: 20px; text-align: center;">
            <a href="/batch.html" style="display: inline-block; background: #fd7e14; color: white; text-decoration: none; padding: 12px 25px; border-radius: 12px; font-weight: 600; transition: transform 0.2s;">
                ðŸ“¦ Batch Download
            </a>
            <p style="color: #868e96; font-size: 14px; margin-top: 10px;">Download multiple videos at once</p>
        </div>
        
        <div class="info-section" id="infoSection">
            <div class="video-info">
                <img id="thumbnail" class="thumbnail" src="" alt="Video thumbnail">
                <div class="video-details">
                    <h3 id="videoTitle">Video Title</h3>
                    <p id="videoUploader">Uploader</p>
                    <p id="videoDuration">Duration</p>
                </div>
            </div>
            
            <div class="formats">
                <h4>Available Formats:</h4>
                <div id="formatsList">
                    <!-- Formats will be loaded here -->
                </div>
            </div>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loadingText">Processing your request...</p>
        </div>
        
        <div class="result" id="result">
            <h3>âœ… Ready to Download!</h3>
            <p id="title"></p>
            <button id="finalDownloadBtn" class="download-btn">ðŸ“¥ Download Now</button>
        </div>
        
        <p class="note">Supports YouTube, Instagram, TikTok, Twitter/X, and 1000+ other platforms</p>
    </div>

    <script>
        let currentVideoInfo = null;
        let selectedFormat = 'best';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Load supported platforms
            fetch('/api/platforms')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('platformsContainer');
                    container.innerHTML = data.platforms.map(platform => `
                        <div class="platform" title="${platform.name}">
                            <div class="platform-icon">${platform.icon}</div>
                            <div class="platform-name">${platform.name}</div>
                        </div>
                    `).join('');
                })
                .catch(error => {
                    console.log('Could not load platforms');
                });
            
            // Get video info button
            document.getElementById('getInfoBtn').addEventListener('click', async function() {
                const url = document.getElementById('videoUrl').value;
                
                if (!url) {
                    alert('Please enter a video URL');
                    return;
                }
                
                // Show loading
                document.getElementById('loading').style.display = 'block';
                document.getElementById('loadingText').textContent = 'Getting video information...';
                document.getElementById('infoSection').style.display = 'none';
                
                try {
                    const response = await fetch('/api/video/info', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ url })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        currentVideoInfo = data.info;
                        displayVideoInfo(data.info);
                        document.getElementById('infoSection').style.display = 'block';
                    } else {
                        throw new Error(data.error || 'Failed to get video info');
                    }
                } catch (error) {
                    alert('Error: ' + error.message);
                } finally {
                    document.getElementById('loading').style.display = 'none';
                }
            });
            
            // Download button
            document.getElementById('downloadBtn').addEventListener('click', async function() {
                const url = document.getElementById('videoUrl').value;
                
                if (!url) {
                    alert('Please enter a video URL');
                    return;
                }
                
                // Show loading
                document.getElementById('loading').style.display = 'block';
                document.getElementById('loadingText').textContent = 'Downloading your video...';
                document.getElementById('result').style.display = 'none';
                document.getElementById('infoSection').style.display = 'none';
                
                try {
                    // Determine which endpoint to use
                    let endpoint = '/api/download';
                    if (url.includes('youtube.com') || url.includes('youtu.be')) {
                        endpoint = '/api/download/youtube';
                    } else if (url.includes('instagram.com')) {
                        endpoint = '/api/download/instagram';
                    } else if (url.includes('tiktok.com') || url.includes('vm.tiktok.com')) {
                        endpoint = '/api/download/tiktok';
                    } else if (url.includes('twitter.com') || url.includes('x.com')) {
                        endpoint = '/api/download/twitter';
                    }
                    
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ 
                            url,
                            format: selectedFormat
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        // Hide loading, show result
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('result').style.display = 'block';
                        
                        // Update result content
                        document.getElementById('title').textContent = data.title || 'Video Ready';
                        
                        // Set up REAL download button
                        document.getElementById('finalDownloadBtn').onclick = function() {
                            if (data.downloadUrl) {
                                window.open(data.downloadUrl, '_blank');
                            } else {
                                alert('Download URL not available');
                            }
                        };
                    } else {
                        throw new Error(data.error || 'Download failed');
                    }
                } catch (error) {
                    document.getElementById('loading').style.display = 'none';
                    alert('Error: ' + error.message);
                }
            });
        });
        
        function displayVideoInfo(info) {
            // Display thumbnail
            const thumbnail = document.getElementById('thumbnail');
            if (info.thumbnail) {
                thumbnail.src = info.thumbnail;
                thumbnail.style.display = 'block';
            } else {
                thumbnail.style.display = 'none';
            }
            
            // Display video details
            document.getElementById('videoTitle').textContent = info.title;
            document.getElementById('videoUploader').textContent = `Uploader: ${info.uploader}`;
            document.getElementById('videoDuration').textContent = `Duration: ${formatDuration(info.duration)}`;
            
            // Display formats
            const formatsList = document.getElementById('formatsList');
            formatsList.innerHTML = '';
            
            if (info.formats && info.formats.length > 0) {
                info.formats.forEach((format, index) => {
                    const formatElement = document.createElement('div');
                    formatElement.className = 'format-option';
                    formatElement.innerHTML = `
                        <div class="format-info">
                            <span><strong>${format.quality}</strong> - ${format.resolution}</span>
                            <span>${format.filesize}</span>
                        </div>
                    `;
                    
                    formatElement.addEventListener('click', function() {
                        // Remove selected class from all formats
                        document.querySelectorAll('.format-option').forEach(el => {
                            el.classList.remove('selected');
                        });
                        
                        // Add selected class to clicked format
                        this.classList.add('selected');
                        selectedFormat = format.format_id;
                    });
                    
                    // Select first format by default
                    if (index === 0) {
                        formatElement.classList.add('selected');
                        selectedFormat = format.format_id;
                    }
                    
                    formatsList.appendChild(formatElement);
                });
            } else {
                formatsList.innerHTML = '<p>No formats available</p>';
            }
        }
        
        function formatDuration(seconds) {
            if (!seconds) return 'Unknown';
            
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            } else {
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }
        }
    </script>
</body>
</html>